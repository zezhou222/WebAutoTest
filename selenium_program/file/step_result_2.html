<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css">
    <style>
        #tt>h5{
            line-height: 25px;
        }
    </style>
</head>
<body>

<div class="container-fluid" style="padding: 10px 30px;">

    <div class="row" style="height: 300px;">
        <div class="col-md-4" id="tt">
            <h5><b>用例名称：</b>{{ uc_name }}</h5>
            <h5><b>用例描述：</b>{{ uc_desc }}</h5>
            <h5><b>执行的用户：</b>{{ username }}</h5>
            <h5><b>用例的执行时间：</b>{{ execute_time }}</h5>
            <h5><b>总运行时间：</b>{{ total_run_time }}s</h5>
            <h5><b>执行结果：</b>
                {% if status == 'failed' %}
                    <span style="color: #ec0000;">{{ status }}</span>
                {% else %}
                    <span style="color: #00d600;">{{ status }}</span>
                {% endif %}
            </h5>
        </div>
        <div class="col-md-8" style="height: 100%;">
            <div id="my_echart" style="width: 100%; height: 100%;"></div>
        </div>

    </div>

    <div class="row">
        <table class="table table-bordered">
            <thead>
            <tr>
                <td width="80">执行顺序</td>
                <td>步骤参数</td>
                <td width="130">是否执行该步骤</td>
                <td width="80">执行状态</td>
                <td width="80">运行时长</td>
                <td>错误信息</td>
            </tr>
            </thead>
            <tbody>
            {% for dic in result_list %}
            <tr {% if dic.parent_step_id and dic.step_id != dic.parent_step_id %} class="hidden bg-info" parent_step_id="{{ dic.parent_step_id }}" {% endif %}>
                <td>
                    <!-- 三角符号，表示可点开看公共用例的执行情况 -->
                    {% if dic.step_id == dic.parent_step_id %}
                    <button class="btn btn-default btn-xs show_public_uc" step_id="{{ dic.step_id }}">
                        {{ loop.index }} <span class="caret"></span>
                    </button>
                    {% else %}
                        {{ loop.index }}
                    {% endif %}
                </td>
                <td>{{ dic.params }}</td>
                <td>
                    {% if dic.execute == 1 %}
                    执行
                    {% endif %}
                </td>
                <td>
                    {% if dic.status == 1 %}
                    <span style="color: #00de00">success</span>
                    {% else %}
                    <span style="color: #de060f">failed</span>
                    {% endif %}
                </td>
                <td>{{ dic.run_time }}s</td>
                <td>
                    {% if dic.error_info != None %}
                        {{ dic.error_info }}
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script src="http://code.jquery.com/jquery-3.4.1.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js"></script>
<script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts/echarts.min.js"></script>
<script>
    var dom = document.getElementById("my_echart");
    var myChart = echarts.init(dom);
    var app = {};
    option = null;
    option = {
        title: {
            text: '图表显示',
            // subtext: '123',
            x: 'center'
        },
        tooltip: {
            trigger: 'item',
            // formatter: "{a} <br/>{b} : {c} ({d}%)"
            formatter: "{a} <br/>{b} ({d}%)"
        },
        legend: {
            orient: 'vertical',
            left: 'left',
            data: ['success: {{ step_success_count }}', 'failed: {{ step_failed_count }}'],
            y: '30px'
        },
        series: [
            {
                name: '结果:',
                type: 'pie',
                // 可以控制饼图大小
                radius: '75%',
                center: ['50%', '55%'],
                data: [
                    {value: "{{ step_success_count }}", name: 'success: {{ step_success_count }}'},
                    {value: "{{ step_failed_count }}", name: 'failed: {{ step_failed_count }}'},
                ],
                color: ['#00d600', '#d1050e'],
                itemStyle: {
                    emphasis: {
                        shadowBlur: 20,
                        shadowOffsetX: 5,
                        shadowColor: 'rgba(0, 0, 0, 0.8)'
                    }
                }
            }
        ]
    };

    if (option && typeof option === "object") {
        myChart.setOption(option, true);
    }

</script>
<script>

    $('.show_public_uc').click(function (e) {
        var step_id = $(this).attr('step_id');
        $('tbody').find(`tr[parent_step_id="${step_id}"]`).toggleClass('hidden');
    });

</script>

</body>
</html>